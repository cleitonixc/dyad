# Plano de Implementa√ß√£o: Funcionalidades Pro Locais

## üìã Vis√£o Geral

Este documento detalha o plano para implementar as funcionalidades Pro do Dyad diretamente no projeto, removendo a depend√™ncia do Dyad Engine externo e tornando essas funcionalidades dispon√≠veis localmente.

### üéØ Objetivos

- [ ] **Privacidade Total**: Manter todos os dados locais sem envio para servidores externos
- [ ] **Remo√ß√£o de Custos**: Eliminar necessidade de subscri√ß√£o Pro
- [ ] **Performance Local**: Reduzir lat√™ncia removendo chamadas de rede
- [ ] **Controle Granular**: Permitir configura√ß√µes avan√ßadas pelo usu√°rio
- [ ] **Open Source**: Disponibilizar funcionalidades para toda a comunidade

---

## üîç An√°lise das Funcionalidades Atuais

### ‚úÖ Funcionalidades Pro Identificadas

- [x] **Smart Context** (`enableProSmartFilesContextMode`)

  - Inclus√£o autom√°tica inteligente de arquivos relevantes
  - Otimiza√ß√£o de contexto para bases de c√≥digo grandes
  - Atualmente processado no `https://engine.dyad.sh/v1`

- [x] **Turbo/Lazy Edits** (`enableProLazyEditsMode`)

  - Edi√ß√µes de arquivo mais r√°pidas e econ√¥micas
  - Usa modelos otimizados para atualiza√ß√µes completas de arquivo
  - Classifica√ß√£o autom√°tica de complexidade de edi√ß√µes

- [x] **Dyad Engine Integration**
  - Sistema atual envia arquivos via `dyad_options`
  - Processa funcionalidades no servidor externo
  - Requer chave API Pro

---

## üèóÔ∏è Fase 1: Smart Context Local

### üìÅ Estrutura de Arquivos

- [ ] **Criar `src/ipc/processors/smart_context_processor.ts`**

  - [ ] Interface `SmartContextProcessor`
  - [ ] M√©todo `analyzeCodebaseForContext()`
  - [ ] M√©todo `identifyRelatedFiles()`
  - [ ] M√©todo `optimizeContextForTokens()`

- [ ] **Criar `src/utils/dependency_analyzer.ts`**

  - [ ] Fun√ß√£o `buildDependencyGraph()`
  - [ ] Fun√ß√£o `parseImportsExports()`
  - [ ] Cache de grafos de depend√™ncia

- [ ] **Criar `src/utils/semantic_analyzer.ts`**
  - [ ] Fun√ß√£o `extractEntitiesFromPrompt()`
  - [ ] Fun√ß√£o `findSemanticMatches()`
  - [ ] Sistema de scoring por relev√¢ncia

### üîß Implementa√ß√£o Core

- [ ] **An√°lise de Depend√™ncias**

  ```typescript
  interface DependencyGraph {
    nodes: Map<string, FileNode>;
    edges: Map<string, string[]>;
    weights: Map<string, number>;
  }

  async function buildDependencyGraph(
    appPath: string,
  ): Promise<DependencyGraph>;
  ```

- [ ] **An√°lise Sem√¢ntica**

  ```typescript
  interface SemanticMatch {
    filePath: string;
    relevanceScore: number;
    matchedEntities: string[];
    contextImportance: number;
  }

  async function findSemanticMatches(
    prompt: string,
    files: string[],
  ): Promise<SemanticMatch[]>;
  ```

- [ ] **Otimiza√ß√£o de Contexto**

  ```typescript
  interface ContextOptimization {
    selectedFiles: string[];
    totalTokens: number;
    relevanceRatio: number;
  }

  async function optimizeContext(
    candidates: string[],
    maxTokens: number,
  ): Promise<ContextOptimization>;
  ```

### üéõÔ∏è Configura√ß√µes Avan√ßadas

- [ ] **Adicionar ao `UserSettingsSchema`**

  ```typescript
  smartContextSensitivity: z.enum(["conservative", "balanced", "aggressive"]).optional(),
  smartContextMaxTokens: z.number().min(1000).max(50000).optional(),
  smartContextDependencyDepth: z.number().min(1).max(5).optional(),
  ```

- [ ] **Implementar Estrat√©gias de Contexto**
  - [ ] **Conservative**: Apenas depend√™ncias diretas + arquivos mencionados
  - [ ] **Balanced**: Depend√™ncias at√© 2 n√≠veis + an√°lise sem√¢ntica
  - [ ] **Aggressive**: An√°lise completa + arquivos relacionados por padr√µes

### üîó Integra√ß√£o com Sistema Existente

- [ ] **Modificar `src/utils/codebase.ts`**

  - [ ] Substituir l√≥gica do `isSmartContextEnabled`
  - [ ] Integrar `SmartContextProcessor` no `extractCodebase()`
  - [ ] Manter compatibilidade com `smartContextAutoIncludes`

- [ ] **Atualizar `src/ipc/handlers/context_paths_handlers.ts`**
  - [ ] Usar processador local em vez de engine externo
  - [ ] Adicionar m√©tricas de performance
  - [ ] Implementar cache de resultados

---

## ‚ö° Fase 2: Turbo Edits Local

### üìÅ Estrutura de Arquivos

- [ ] **Criar `src/ipc/processors/turbo_edits_processor.ts`**

  - [ ] Interface `TurboEditsProcessor`
  - [ ] M√©todo `generateOptimizedEdit()`
  - [ ] M√©todo `validateEdit()`
  - [ ] M√©todo `estimateEditComplexity()`

- [ ] **Criar `src/prompts/edit_templates.ts`**

  - [ ] Templates para edi√ß√µes simples
  - [ ] Templates para refatora√ß√£o
  - [ ] Templates para mudan√ßas estruturais

- [ ] **Criar `src/utils/edit_validator.ts`**
  - [ ] Valida√ß√£o de sintaxe
  - [ ] Verifica√ß√£o de estrutura
  - [ ] Detec√ß√£o de breaking changes

### üéØ Sistema de Classifica√ß√£o

- [ ] **Implementar `EditComplexity` enum**

  ```typescript
  enum EditComplexity {
    SIMPLE = "simple", // Corre√ß√µes de texto, typos
    MODERATE = "moderate", // Refatora√ß√£o de fun√ß√µes
    COMPLEX = "complex", // Mudan√ßas arquiteturais
    MULTI_FILE = "multi_file", // Mudan√ßas em m√∫ltiplos arquivos
  }
  ```

- [ ] **Implementar `EditStrategy` interface**
  ```typescript
  interface EditStrategy {
    modelSelection: "fast" | "balanced" | "powerful";
    promptTemplate: string;
    maxTokens: number;
    validationLevel: "basic" | "enhanced" | "strict";
    retryPolicy: RetryPolicy;
  }
  ```

### ü§ñ Sele√ß√£o de Modelo Inteligente

- [ ] **Criar sistema de roteamento de modelos**

  - [ ] Edi√ß√µes simples ‚Üí Modelos r√°pidos/baratos
  - [ ] Edi√ß√µes complexas ‚Üí Modelos mais poderosos
  - [ ] Fallback autom√°tico em caso de falha

- [ ] **Implementar templates otimizados**
  - [ ] Template para corre√ß√µes de sintaxe
  - [ ] Template para adi√ß√£o de funcionalidades
  - [ ] Template para refatora√ß√£o
  - [ ] Template para otimiza√ß√£o de c√≥digo

### üîç Valida√ß√£o e Qualidade

- [ ] **Sistema de valida√ß√£o autom√°tica**

  ```typescript
  interface EditValidation {
    syntaxValid: boolean;
    structureIntact: boolean;
    potentialIssues: string[];
    confidence: number;
  }
  ```

- [ ] **Implementar m√©tricas de qualidade**
  - [ ] Taxa de sucesso por tipo de edi√ß√£o
  - [ ] Tempo m√©dio de processamento
  - [ ] Necessidade de retrabalho

---

## üîÑ Fase 3: Remo√ß√£o de Depend√™ncias Externas

### üóëÔ∏è Remover Integra√ß√£o com Dyad Engine

- [ ] **Substituir `src/ipc/utils/llm_engine_provider.ts`**

  - [ ] Criar `src/ipc/utils/local_pro_provider.ts`
  - [ ] Implementar wrapper para funcionalidades locais
  - [ ] Manter interface compat√≠vel

- [ ] **Modificar `src/ipc/utils/get_model_client.ts`**
  - [ ] Remover chamadas para `createDyadEngine()`
  - [ ] Usar `createLocalProProvider()` em vez disso
  - [ ] Manter l√≥gica de fallback

### üîß Novo Provider Local

- [ ] **Implementar `createLocalProProvider()`**
  ```typescript
  export function createLocalProProvider(
    baseProvider: any,
    settings: UserSettings,
    files?: File[],
  ): ProEnhancedProvider {
    return {
      ...baseProvider,
      model: (modelId: string, config?: any) => {
        let enhancedModel = baseProvider.model(modelId, config);

        if (settings.enableLocalSmartContext) {
          enhancedModel = wrapWithSmartContext(enhancedModel, files);
        }

        if (settings.enableLocalTurboEdits) {
          enhancedModel = wrapWithTurboEdits(enhancedModel);
        }

        return enhancedModel;
      },
    };
  }
  ```

### üéõÔ∏è Wrappers de Funcionalidade

- [ ] **Implementar `wrapWithSmartContext()`**

  - [ ] Interceptar prompts para adicionar contexto inteligente
  - [ ] Aplicar otimiza√ß√µes de token
  - [ ] Adicionar m√©tricas de uso

- [ ] **Implementar `wrapWithTurboEdits()`**
  - [ ] Detectar inten√ß√£o de edi√ß√£o em prompts
  - [ ] Aplicar templates otimizados
  - [ ] Usar sele√ß√£o de modelo inteligente

---

## üé® Fase 4: Atualiza√ß√£o da Interface

### üîÑ Modificar Componentes Existentes

- [ ] **Atualizar `src/components/ProModeSelector.tsx`**

  - [ ] Remover depend√™ncia de `enableDyadPro`
  - [ ] Atualizar tooltips para refletir implementa√ß√£o local
  - [ ] Adicionar configura√ß√µes granulares
  - [ ] Remover links para subscri√ß√£o

- [ ] **Modificar `src/components/ContextFilesPicker.tsx`**
  - [ ] Atualizar condicionais de `isSmartContextEnabled`
  - [ ] Adicionar indicadores de processamento local
  - [ ] Mostrar m√©tricas de performance

### üÜï Novos Componentes de Configura√ß√£o

- [ ] **Criar `src/components/SmartContextSettings.tsx`**

  - [ ] Slider para sensibilidade
  - [ ] Configura√ß√£o de profundidade de depend√™ncias
  - [ ] Preview de arquivos que ser√£o inclu√≠dos

- [ ] **Criar `src/components/TurboEditsSettings.tsx`**
  - [ ] Sele√ß√£o de threshold de complexidade
  - [ ] Configura√ß√£o de estrat√©gias de modelo
  - [ ] M√©tricas de performance

### üìä Componentes de Monitoramento

- [ ] **Criar `src/components/ProFeaturesMonitor.tsx`**
  - [ ] Dashboard de uso das funcionalidades
  - [ ] M√©tricas de economia de tokens
  - [ ] Estat√≠sticas de performance

---

## ‚öôÔ∏è Fase 5: Configura√ß√µes e Schemas

### üìã Atualizar Schemas

- [ ] **Modificar `src/lib/schemas.ts`**

  ```typescript
  // Remover depend√™ncia de enableDyadPro
  enableLocalSmartContext: z.boolean().optional(),
  enableLocalTurboEdits: z.boolean().optional(),

  // Configura√ß√µes granulares
  smartContextSensitivity: z.enum(["conservative", "balanced", "aggressive"]).optional(),
  smartContextMaxTokens: z.number().min(1000).max(50000).optional(),
  smartContextDependencyDepth: z.number().min(1).max(5).optional(),

  turboEditsComplexityThreshold: z.enum(["simple", "moderate", "all"]).optional(),
  turboEditsModelStrategy: z.enum(["fast", "balanced", "quality"]).optional(),
  ```

### üîß Configura√ß√µes Padr√£o

- [ ] **Atualizar `src/main/settings.ts`**
  ```typescript
  const DEFAULT_SETTINGS: UserSettings = {
    // ... existing
    enableLocalSmartContext: true,
    enableLocalTurboEdits: true,
    smartContextSensitivity: "balanced",
    smartContextMaxTokens: 20000,
    smartContextDependencyDepth: 2,
    turboEditsComplexityThreshold: "moderate",
    turboEditsModelStrategy: "balanced",
  };
  ```

### üîÑ Migra√ß√£o de Configura√ß√µes

- [ ] **Criar script de migra√ß√£o**
  - [ ] Converter `enableProSmartFilesContextMode` ‚Üí `enableLocalSmartContext`
  - [ ] Converter `enableProLazyEditsMode` ‚Üí `enableLocalTurboEdits`
  - [ ] Manter compatibilidade tempor√°ria

---

## üß™ Fase 6: Testes e Valida√ß√£o

### üî¨ Testes Unit√°rios

- [ ] **Testes para Smart Context**

  - [ ] `smart_context_processor.test.ts`
  - [ ] `dependency_analyzer.test.ts`
  - [ ] `semantic_analyzer.test.ts`

- [ ] **Testes para Turbo Edits**
  - [ ] `turbo_edits_processor.test.ts`
  - [ ] `edit_validator.test.ts`
  - [ ] `edit_templates.test.ts`

### üîß Testes de Integra√ß√£o

- [ ] **Testes E2E**
  - [ ] `local_pro_features.spec.ts`
  - [ ] Cen√°rios de uso real
  - [ ] Compara√ß√£o de performance

### üìä Benchmarks

- [ ] **M√©tricas de Performance**
  - [ ] Tempo de processamento vs. engine externo
  - [ ] Qualidade das sugest√µes
  - [ ] Economia de tokens

---

## üìà Fase 7: Otimiza√ß√£o e Polimento

### ‚ö° Otimiza√ß√µes de Performance

- [ ] **Cache Inteligente**

  - [ ] Cache de grafos de depend√™ncia
  - [ ] Cache de an√°lise sem√¢ntica
  - [ ] Invalida√ß√£o autom√°tica

- [ ] **Processamento Ass√≠ncrono**
  - [ ] Background processing para an√°lises pesadas
  - [ ] Indicadores de progresso
  - [ ] Cancelamento de opera√ß√µes

### üîç Monitoramento e M√©tricas

- [ ] **Sistema de Telemetria Local**
  - [ ] Coleta de m√©tricas de uso
  - [ ] Analytics de performance
  - [ ] Detec√ß√£o de problemas

### üìö Documenta√ß√£o

- [ ] **Documenta√ß√£o T√©cnica**

  - [ ] Guia de arquitetura
  - [ ] API reference
  - [ ] Troubleshooting guide

- [ ] **Documenta√ß√£o do Usu√°rio**
  - [ ] Guia de configura√ß√£o
  - [ ] Melhores pr√°ticas
  - [ ] FAQ

---

## üéØ Crit√©rios de Sucesso

### ‚úÖ Funcionalidade

- [ ] Smart Context funciona sem depend√™ncias externas
- [ ] Turbo Edits mant√©m qualidade compar√°vel
- [ ] Interface √© intuitiva e responsiva
- [ ] Migra√ß√£o √© transparente para usu√°rios

### üìä Performance

- [ ] Tempo de resposta ‚â§ 500ms para Smart Context
- [ ] Tempo de resposta ‚â§ 200ms para classifica√ß√£o de edi√ß√µes
- [ ] Uso de mem√≥ria ‚â§ 100MB adicional
- [ ] Cache hit rate ‚â• 80%

### üîí Qualidade

- [ ] Taxa de sucesso ‚â• 95% para funcionalidades
- [ ] Cobertura de testes ‚â• 90%
- [ ] Zero vazamentos de mem√≥ria
- [ ] Graceful degradation em casos de erro

---

## üöÄ Cronograma Estimado

### üìÖ Timeline

- **Semana 1-2**: Fase 1 (Smart Context Local)
- **Semana 3-4**: Fase 2 (Turbo Edits Local)
- **Semana 5**: Fase 3 (Remo√ß√£o de Depend√™ncias)
- **Semana 6**: Fase 4 (Atualiza√ß√£o da Interface)
- **Semana 7**: Fase 5 (Configura√ß√µes e Schemas)
- **Semana 8-9**: Fase 6 (Testes e Valida√ß√£o)
- **Semana 10**: Fase 7 (Otimiza√ß√£o e Polimento)

### üéØ Milestones

- [ ] **M1**: Smart Context b√°sico funcionando
- [ ] **M2**: Turbo Edits classificando corretamente
- [ ] **M3**: Depend√™ncias externas removidas
- [ ] **M4**: Interface atualizada e configur√°vel
- [ ] **M5**: Beta pronto para testes
- [ ] **M6**: Release candidate

---

## üîÑ Pr√≥ximos Passos

### üöÄ In√≠cio Imediato

1. [ ] **Configurar estrutura de arquivos**
2. [ ] **Implementar interfaces b√°sicas**
3. [ ] **Criar testes scaffolding**
4. [ ] **Come√ßar com dependency analyzer**

### üéØ Prioridades

1. **Alta**: Smart Context (maior impacto no usu√°rio)
2. **Alta**: Remo√ß√£o de depend√™ncias (independ√™ncia)
3. **M√©dia**: Turbo Edits (otimiza√ß√£o)
4. **M√©dia**: Interface avan√ßada (usabilidade)
5. **Baixa**: M√©tricas e monitoramento (observabilidade)

---

## üí° Benef√≠cios Esperados

### üîí Para o Usu√°rio

- **Privacidade Total**: Dados nunca saem da m√°quina
- **Custo Zero**: Sem necessidade de subscri√ß√£o
- **Performance**: Menor lat√™ncia, maior responsividade
- **Controle**: Configura√ß√µes granulares
- **Transpar√™ncia**: C√≥digo aberto e audit√°vel

### üèóÔ∏è Para o Projeto

- **Independ√™ncia**: Sem depend√™ncias de servi√ßos externos
- **Sustentabilidade**: Modelo de neg√≥cio mais simples
- **Comunidade**: Funcionalidades abertas para contribui√ß√µes
- **Inova√ß√£o**: Base para futuras funcionalidades avan√ßadas
- **Competitividade**: Diferencial no mercado open-source

---

## ‚ö†Ô∏è Riscos e Mitiga√ß√µes

### üö® Riscos Identificados

- [ ] **Qualidade**: Implementa√ß√£o local pode ser inferior
  - **Mitiga√ß√£o**: Benchmarks rigorosos e itera√ß√£o cont√≠nua
- [ ] **Performance**: Processamento local pode ser lento
  - **Mitiga√ß√£o**: Otimiza√ß√µes, cache e processamento ass√≠ncrono
- [ ] **Complexidade**: Aumento da complexidade do c√≥digo
  - **Mitiga√ß√£o**: Arquitetura modular e documenta√ß√£o extensa
- [ ] **Manuten√ß√£o**: Mais c√≥digo para manter
  - **Mitiga√ß√£o**: Testes automatizados e CI/CD robusto

### üõ°Ô∏è Planos de Conting√™ncia

- [ ] **Fallback**: Manter compatibilidade com engine externo
- [ ] **Rollback**: Versioning cuidadoso para revers√£o
- [ ] **Suporte**: Documenta√ß√£o para troubleshooting
- [ ] **Monitoramento**: Alertas para problemas de performance

---

_Este documento √© um plano vivo e ser√° atualizado conforme o progresso da implementa√ß√£o._
